# 话单查询时间范围说明

## 📅 时间查询逻辑

### 后端处理

后端会自动处理结束时间，**加1天**以包含当天的所有数据：

```python
# backend/app/routers/cdr.py
begin_dt = datetime.strptime(query_params.begin_time, '%Y%m%d')  # 00:00:00
end_dt = datetime.strptime(query_params.end_time, '%Y%m%d') + timedelta(days=1)  # 次日00:00:00
```

### 查询示例

**查询 2025年10月23日 的所有话单：**

前端设置：
- 开始日期：`2025-10-23`
- 结束日期：`2025-10-23`

后端实际查询：
- 开始时间：`2025-10-23 00:00:00`
- 结束时间：`2025-10-24 00:00:00`（自动加1天）

这样就包含了10月23日从00:00:00到23:59:59的所有数据。

**查询 2025年10月22日 到 10月23日 的话单：**

前端设置：
- 开始日期：`2025-10-22`
- 结束日期：`2025-10-23`

后端实际查询：
- 开始时间：`2025-10-22 00:00:00`
- 结束时间：`2025-10-24 00:00:00`（自动加1天）

包含22日和23日两天的完整数据。

## 🎯 为什么需要这样设计？

### 问题
如果不加1天，查询 `2025-10-23` 会变成：
- 开始：`2025-10-23 00:00:00`
- 结束：`2025-10-23 00:00:00`

这样无法查到任何数据（范围为0）！

### 解决方案
后端自动给结束时间加1天：
- 开始：`2025-10-23 00:00:00`
- 结束：`2025-10-24 00:00:00`

这样就能查到10月23日全天的数据。

## 📝 前端显示

### 查询表单提示
```
开始日期（含当天00:00）
结束日期（含当天23:59）
```

### 时间显示格式

**列表显示**：完整格式
```
2025-10-23 09:04
```

**显示内容**：
- 年-月-日 时:分
- 不显示秒（简化界面）

## 🔍 常见问题

### Q1: 为什么我设置查询10月23日，但需要设置为10-22到10-23？
**A**: 这是误解！正确方式是：
- 开始：10-23
- 结束：10-23
- 后端会自动处理为：10-23 00:00 到 10-24 00:00

### Q2: 如果我想查询多天的数据？
**A**: 
- 查询10月20日到10月23日
- 开始：10-20
- 结束：10-23
- 实际查询：10-20 00:00 到 10-24 00:00
- 包含20、21、22、23共4天的完整数据

### Q3: 最多可以查询多少天？
**A**: 
- 系统限制：最多31天
- 超过31天会提示错误
- 建议：分批查询大范围数据

### Q4: 可以查询多久以前的数据？
**A**:
- 系统限制：1年内的数据
- 超过1年的数据在归档系统中

## 💡 最佳实践

1. **查询单天数据**：开始和结束设置为同一天
2. **查询范围数据**：开始设置为第一天，结束设置为最后一天
3. **大范围查询**：建议不超过7天，性能更好
4. **导出数据**：先查询后导出，不要盲目导出大量数据

## 🔧 技术实现

### 前端传参
```javascript
{
  begin_time: "20251023",  // yyyyMMdd格式
  end_time: "20251023"
}
```

### 后端处理
```python
begin_dt = datetime.strptime(begin_time, '%Y%m%d')
end_dt = datetime.strptime(end_time, '%Y%m%d') + timedelta(days=1)

# 查询条件
WHERE start_time >= begin_dt AND start_time < end_dt
```

### 时间字段格式

后端可能返回以下格式：
1. **毫秒时间戳**（数字）：`1729656240000`
2. **数字字符串**：`"1729656240000"`
3. **格式化字符串**：`"2025-10-23 09:04:15"`

前端会自动识别并统一显示为：`2025-10-23 09:04`

---

**更新日期**: 2025-10-24
**版本**: 1.0

